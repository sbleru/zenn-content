---
title: "Terraform - direnvã§ãƒ•ã‚©ãƒ«ãƒ€ã”ã¨ã«gcpã‚„awsã®configã‚’åˆ‡ã‚Šæ›¿ãˆã‚ˆã†"
emoji: "ğŸ’¨"
type: "tech"
topics:
  - "aws"
  - "gcp"
  - "terraform"
  - "direnv"
published: true
published_at: "2024-05-24 00:17"
---

# ä½•ï¼Ÿ

- terraformã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§é‹ç”¨ã—ã¦ã„ã‚‹ã¨ã€devã‚„prodç’°å¢ƒã”ã¨ã«ã€GCPã‚„AWSã®ãƒ—ãƒ­ãƒã‚¤ãƒ€ã®configã‚’åˆ‡ã‚Šæ›¿ãˆãŸããªã‚‹
- ã„ã¡ã„ã¡ã‚³ãƒãƒ³ãƒ‰ã‚’å©ã„ã¦ç¾åœ¨ã®è¨­å®šã‚’æ›¸ãæ›ãˆã‚‹ã®ã¯é¢å€’ã ã—ã€ç•°ãªã‚‹ç’°å¢ƒã«å¯¾ã—ã¦èª¤ã£ãŸè¨­å®šã‚’ã—ã¦ã—ã¾ã†å¯èƒ½æ€§ã‚‚ã‚ã‚‹
- direnvã‚’ä½¿ã†ã¨ãƒ•ã‚©ãƒ«ãƒ€ç§»å‹•ã§è‡ªå‹•ã§configã‚’é©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã‚‹

# å‰æ

ä»¥ä¸‹ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹

- [direnv](https://github.com/direnv/direnv)
    
    ```bash
    brew install direnv
    ```
    
- gcloud cli
    - GCPã‚’ä½¿ã†å ´åˆ
- aws cli
    - AWSã‚’ä½¿ã†å ´åˆ

# GCPã‚’ä½¿ã†å ´åˆ

## configurationã‚’ä½œæˆã™ã‚‹

configuration ã®ä¸€è¦§è¡¨ç¤º

```bash
gcloud config configurations list
```

configurationã®ä½œæˆ

```bash
# my-dev ã‚’é©å®œå¤‰æ›´
gcloud config configurations create my-dev
```

configurationã®åˆæœŸåŒ–ï¼ˆåˆå›ã®ã¿ï¼‰

```bash
# promptã«å¾“ã£ã¦è¨­å®šã™ã‚‹
gcloud init
```

configuration ã®ä¸€è¦§è¡¨ç¤ºï¼ˆç¢ºèªï¼‰

```bash
gcloud config configurations list
```

è£œè¶³

configuration ã®å‰Šé™¤

```bash
gcloud config configurations delete my-dev
```

## .envrcã‚’å®šç¾©ã™ã‚‹

 configã‚’é©ç”¨ã—ãŸã„ãƒ•ã‚©ãƒ«ãƒ€ã« `.envrc` ã‚’ä½œæˆã—ã€ä»¥ä¸‹ã‚’è¿½è¨˜

```bash
export CLOUDSDK_ACTIVE_CONFIG_NAME=my-dev
```

èª­ã¿è¾¼ã¾ã‚Œãªã„å ´åˆ

```bash
# è¨±å¯ã™ã‚‹
direnv allow
# shell ã‚’ å†èµ·å‹•ã™ã‚‹
exec $SHELL -l
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

- èªè¨¼ãŒé€šã‚‰ãªã„
    - ADCã‚’æ›´æ–°ã™ã‚‹
        
        ```bash
        gcloud auth application-default login
        ```
        
    - ADCï¼ˆApplication Default Credentialï¼‰ã¯ã€configurationsã§åˆ‡ã‚Šæ›¿ã‚ã‚‰å›³ã€ãã®ã¾ã¾ã®ãŸã‚ã€èªè¨¼ãŒé€šã‚‰ãªã„å ´åˆã¯å†åº¦ãƒ­ã‚°ã‚¤ãƒ³ã‚’è¡Œã†å¿…è¦ãŒã‚ã‚‹ã€‚ï¼ˆä¼šç¤¾ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚„å€‹äººã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒç•°ãªã‚‹å ´åˆãªã©ï¼‰

# AWSã‚’ä½¿ã†å ´åˆ

## configurationã‚’ä½œæˆã™ã‚‹

```bash
aws configure --profile my-dev
```

## .envrcã‚’å®šç¾©ã™ã‚‹

 configã‚’é©ç”¨ã—ãŸã„ãƒ•ã‚©ãƒ«ãƒ€ã« `.envrc` ã‚’ä½œæˆã—ã€ä»¥ä¸‹ã‚’è¿½è¨˜

```bash
export AWS_PROFILE=my-dev
```

# ãŠã¾ã‘

terraformã«ã¯ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã‚’è¨­å®šã™ã‚‹ã“ã¨ãŒã§ãã€ç’°å¢ƒå¤‰æ•°ã‚‚ç”¨æ„ã•ã‚Œã¦ã„ã‚‹

[Debugging | Terraform | HashiCorp Developer](https://developer.hashicorp.com/terraform/internals/debugging)

`.envrc` ã«ä»¥ä¸‹ã®ã‚ˆã†ã«å®šç¾©ã™ã‚‹ã“ã¨ã§ã€ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã‚’ç‰¹å®šã®ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãå‡ºã™ã“ã¨ã‚‚ã§ãã‚‹

```bash
export TF_LOG=DEBUG
export TF_LOG_PATH=/tmp/terraform_debug.log
```

# å‚è€ƒæ–‡çŒ®

- [gcloud ã® configurations ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ - ã½é´ãªç¼¶](https://blog.pokutuna.com/entry/gcloud-switch-configurations)
- [Terraformã®ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã‚’èª¿æ•´ã™ã‚‹æ–¹æ³•(TF_LOG)](https://zenn.dev/ring_belle/articles/terraform-log-level)
- [Debugging | Terraform | HashiCorp Developer](https://developer.hashicorp.com/terraform/internals/debugging)