---
title: "jsでgroup byするメモ"
emoji: "🍇"
type: "tech"
topics:
  - "javascript"
  - "typescript"
published: true
published_at: "2021-09-23 18:11"
---

# WHY

オブジェクトのリストに対して、SQLのようにgroup byしてcountしたオブジェクトが欲しかった

# HOW

- オブジェクトのパラメータにcountを追加するのではなく、ひとつ階層を増やして、`data`に元のオブジェクトを、`count` にカウント数を入れるようにした。
    - listに渡されるオブジェクトは同じ型を持ったオブジェクトである想定
- reduceでカウントして、最後mapで整形

```tsx
export const groupBy = <T, K extends keyof T>(
  list: T[],
  groupingField: K
): {
  data: T;
  count: number;
}[] => {
  return (
    list
      // 'groupingField' のkeyで一致するobjがあったらcount up
      .reduce((acc, cur) => {
        const result = acc.find(
          (el) => el[groupingField] === cur[groupingField]
        );
        if (result) {
          result.count += 1;
        } else {
          acc.push({
            ...cur,
            count: 1,
          });
        }
        return acc;
      }, [])
      // 返り値に合わせる
      .map(({ count, ...rest }) => ({
        data: rest,
        count,
      }))
  );
};
```

# Reference

- reduce

    [Array.prototype.reduce() - JavaScript | MDN](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Array/reduce#%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E9%85%8D%E5%88%97%E3%81%AE%E5%80%A4%E3%81%AE%E5%90%88%E8%A8%88%E5%80%A4%E3%82%92%E5%87%BA%E3%81%99)

- 引数をジェネリクスのオブジェクト内に限定するのどうやるんだっけと思い

    [Documentation - Generics](https://www.typescriptlang.org/docs/handbook/2/generics.html#using-type-parameters-in-generic-constraints)